<!DOCTYPE html>
<html>
<head>
    <title>Authentication Test - Business Daily Deals</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>Business Daily Deals - Authentication Test</h1>
    
    <div id="status" class="status">Testing authentication...</div>
    
    <button class="button" onclick="testAuth()">Check Authentication Status</button>
    <button class="button" onclick="debugLogin()">Debug Login</button>
    <button class="button" onclick="testSupplierDashboard()">Test Supplier Dashboard</button>
    
    <h2>Test Results</h2>
    <pre id="results">Click buttons above to run tests...</pre>

    <script>
        async function testAuth() {
            try {
                const response = await fetch('/api/auth/user', {
                    credentials: 'include'
                });
                const data = await response.json();
                
                document.getElementById('status').innerHTML = response.ok 
                    ? `✅ AUTHENTICATED: ${data.firstName} ${data.lastName} (${data.userType})`
                    : `❌ NOT AUTHENTICATED: ${data.message}`;
                document.getElementById('status').className = response.ok ? 'status success' : 'status error';
                document.getElementById('results').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('status').innerHTML = `❌ ERROR: ${error.message}`;
                document.getElementById('status').className = 'status error';
                document.getElementById('results').textContent = error.message;
            }
        }

        async function debugLogin() {
            try {
                const response = await fetch('/api/debug/auth', {
                    credentials: 'include'
                });
                const data = await response.json();
                
                document.getElementById('results').textContent = JSON.stringify(data, null, 2);
                
                // Test auth status after login
                setTimeout(testAuth, 1000);
            } catch (error) {
                document.getElementById('results').textContent = error.message;
            }
        }

        async function testSupplierDashboard() {
            try {
                const response = await fetch('/api/supplier/deals', {
                    credentials: 'include'
                });
                const data = await response.json();
                
                document.getElementById('results').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('results').textContent = error.message;
            }
        }

        // Test on page load
        testAuth();
    </script>
</body>
</html>